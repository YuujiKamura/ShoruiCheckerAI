# ShoruiChecker

失敗事例を資産に変える、PDF書類チェッカー。

## 解決する問題

日常業務の大半は、根拠となる証票の写しと集計表の整合性を確認すること。

細部まで見てない書類は、高確率で何処かが間違っている。  
そして大抵の場合、細かく見ていない。

## このツールの考え方

**失敗を検出するだけでなく、失敗パターンを蓄積する**。

```
┌─────────────────┐
│  PDF書類        │
│  （契約書等）    │
└────────┬────────┘
         ▼
┌─────────────────┐
│  AIチェック     │ ← 過去の失敗パターンを参照
│  (Gemini)       │
└────────┬────────┘
         ▼
┌─────────────────┐     ┌─────────────────┐
│  結果をPDFに    │────▶│  ガイドライン   │
│  埋め込み保存   │     │  自動更新       │
└─────────────────┘     └─────────────────┘
                              │
                              ▼
                        次回のチェックに反映
```

1. **チェック結果をPDFに埋め込む** - 解析結果がファイルと一緒に残る
2. **失敗パターンをガイドライン化** - 検出した問題を `.guidelines.json` に蓄積
3. **次回チェック時に参照** - 同じフォルダの書類は過去の失敗パターンを踏まえてチェック

## 使い方（GUIがメイン）

### 基本フロー

1. **監視フォルダを指定**して開始する  
2. 追加/更新されたPDFが**リストに自動反映**される  
3. リストから選択して**解析**  
4. 結果がPDFに埋め込まれ、履歴として残る  
5. 必要に応じて**ガイドライン生成**で失敗パターンを資産化  

### フォルダ監視とリスト更新

1. 監視したいフォルダを指定して開始
2. PDFが追加/更新されるとリストが更新
3. 最新のPDFがすぐにチェック対象になる

### 解析

1. リストからPDFを選択
2. 「解析」を実行
3. 結果がPDFに埋め込まれる

#### 個別解析（単体チェック）

1. 選択したPDF**単体**を対象に内容の矛盾や計算ミスを検出
2. 書類タイプに応じたガイドラインを適用
3. 結果をPDFメタデータに埋め込み

#### 照合解析（書類間チェック）

1. 関連するPDF**同士**を指定して照合
2. 数量・金額・日付・人数などの**整合性**をチェック
3. 不一致があれば理由と根拠を提示して記録

### ガイドライン生成

過去にチェックしたPDFから失敗パターンを抽出:

1. チェック済みのPDFを選択
2. 「ガイドライン生成」を実行
3. 検出された問題が `.guidelines.json` に保存
4. 以降のチェックで自動参照

### 右クリックでチェック（補助）

1. PDFファイルを右クリック
2. 「書類チェック」を選択
3. AIが整合性をチェック
4. 結果がPDFに埋め込まれる

## 対応書類タイプ

| 書類タイプ | チェック項目例 |
|-----------|---------------|
| 契約書 | 金額計算、工期日付、当事者名の一貫性 |
| 見積書 | 数量×単価の計算、税込/税抜 |
| 請求書 | 金額、日付、宛先 |
| 交通誘導員配置表 | 人数と名前リストの一致、時間計算 |
| 測量図面 | 縦断/横断の計画高・地盤高の照合 |

ファイル名から書類タイプを自動判定し、該当するガイドラインのみ適用。

## 技術スタック

- **フロントエンド**: Tauri + Vanilla JS
- **バックエンド**: Rust
- **AI**: Gemini API（cli-ai-analyzer経由）
- **PDF処理**: Poppler（テキスト抽出）

## インストール

```powershell
# 右クリックメニューに追加（Claude CLIを利用）
.\install-context-menu.ps1

# 削除する場合
.\uninstall-context-menu.ps1
```

### 右クリックメニューの動作

- `install-context-menu.ps1` は `HKCU\Software\Classes\SystemFileAssociations\.pdf\shell\AIAnalyze` を登録
- `%LOCALAPPDATA%\ShoruiChecker\pdf-analyze.cmd` を作成し、複数PDFを一括でClaude CLIへ渡す
- 「AI Analyze (Claude)」として表示され、複数選択に対応
- `uninstall-context-menu.ps1` はレジストリ設定を削除（ラッパーCMDは残る）

## 設定

- **監視フォルダ**: 自動チェックするフォルダ
- **AIモデル**: gemini-2.0-flash-exp（デフォルト）

## 仕組み

### PDF埋め込み

チェック結果はPDFのメタデータに埋め込まれる:
- 解析結果
- チェック日時
- 使用したカスタム指示

同じPDFを開くと、過去のチェック結果が表示される。

### ガイドライン

`.guidelines.json` 構造:

```json
{
  "common": [
    "税込/税抜の混在に注意",
    "日付の西暦/和暦混在"
  ],
  "categories": {
    "契約書": [
      "工事価格 + 消費税 = 請負代金額の計算確認",
      "着工日 < 完成日の日付順序"
    ],
    "交通誘導員": [
      "人数欄と名前リストの一致確認"
    ]
  }
}
```

## 既存ツールとの違い

| ツール | アプローチ |
|--------|-----------|
| 一般的なPDFチェッカー | 決まったルールでチェック |
| このツール | **失敗から学んで**ルールを蓄積 |

同じミスを二度としないためのツール。

## 依存クレート

- [cli-ai-analyzer](https://github.com/YuujiKamura/cli-ai-analyzer) - AI呼び出し

## ライセンス

MIT
